{"version":3,"sources":["webpack:///./node_modules/@theia/mini-browser/src/browser/location-mapper-service.ts"],"names":[],"mappings":"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","file":"44.bundle.js","sourcesContent":["/********************************************************************************\n * Copyright (C) 2018 TypeFox and others.\n *\n * This program and the accompanying materials are made available under the\n * terms of the Eclipse Public License v. 2.0 which is available at\n * http://www.eclipse.org/legal/epl-2.0.\n *\n * This Source Code may also be made available under the following Secondary\n * Licenses when the conditions for such availability set forth in the Eclipse\n * Public License v. 2.0 are satisfied: GNU General Public License, version 2\n * with the GNU Classpath Exception which is available at\n * https://www.gnu.org/software/classpath/license.html.\n *\n * SPDX-License-Identifier: EPL-2.0 OR GPL-2.0 WITH Classpath-exception-2.0\n ********************************************************************************/\n\nimport { inject, injectable, named } from 'inversify';\nimport URI from '@theia/core/lib/common/uri';\nimport { Endpoint } from '@theia/core/lib/browser';\nimport { MaybePromise, Prioritizeable } from '@theia/core/lib/common/types';\nimport { ContributionProvider } from '@theia/core/lib/common/contribution-provider';\n\n/**\n * Contribution for the `LocationMapperService`.\n */\nexport const LocationMapper = Symbol('LocationMapper');\nexport interface LocationMapper {\n\n    /**\n     * Should return with a positive number if the current contribution can handle the given location.\n     * The number indicates the priority of the location mapper. If it is not a positive number, it means, the\n     * contribution cannot handle the location.\n     */\n    canHandle(location: string): MaybePromise<number>;\n\n    /**\n     * Maps the given location.\n     */\n    map(location: string): MaybePromise<string>;\n\n}\n\n/**\n * Location mapper service.\n */\n@injectable()\nexport class LocationMapperService {\n\n    @inject(ContributionProvider)\n    @named(LocationMapper)\n    protected readonly contributions: ContributionProvider<LocationMapper>;\n\n    async map(location: string): Promise<string> {\n        const contributions = await this.prioritize(location);\n        if (contributions.length === 0) {\n            return this.defaultMapper()(location);\n        }\n        return contributions[0].map(location);\n    }\n\n    protected defaultMapper(): (location: string) => MaybePromise<string> {\n        return location => `${new Endpoint().httpScheme}//${location}`;\n    }\n\n    protected async prioritize(location: string): Promise<LocationMapper[]> {\n        const prioritized = await Prioritizeable.prioritizeAll(this.getContributions(), contribution => contribution.canHandle(location));\n        return prioritized.map(p => p.value);\n    }\n\n    protected getContributions(): LocationMapper[] {\n        return this.contributions.getContributions();\n    }\n\n}\n\n/**\n * HTTP location mapper.\n */\n@injectable()\nexport class HttpLocationMapper implements LocationMapper {\n\n    canHandle(location: string): MaybePromise<number> {\n        return location.startsWith('http://') ? 1 : 0;\n    }\n\n    map(location: string): MaybePromise<string> {\n        return location;\n    }\n\n}\n\n/**\n * HTTPS location mapper.\n */\n@injectable()\nexport class HttpsLocationMapper implements LocationMapper {\n\n    canHandle(location: string): MaybePromise<number> {\n        return location.startsWith('https://') ? 1 : 0;\n    }\n\n    map(location: string): MaybePromise<string> {\n        return location;\n    }\n\n}\n\n/**\n * Location mapper for locations without a scheme.\n */\n@injectable()\nexport class LocationWithoutSchemeMapper implements LocationMapper {\n\n    canHandle(location: string): MaybePromise<number> {\n        return new URI(location).scheme === '' ? 1 : 0;\n    }\n\n    map(location: string): MaybePromise<string> {\n        return `http://${location}`;\n    }\n\n}\n\n/**\n * `file` URI location mapper.\n */\n@injectable()\nexport class FileLocationMapper implements LocationMapper {\n\n    canHandle(location: string): MaybePromise<number> {\n        return location.startsWith('file://') ? 1 : 0;\n    }\n\n    map(location: string): MaybePromise<string> {\n        const uri = new URI(location);\n        if (uri.scheme !== 'file') {\n            throw new Error(`Only URIs with 'file' scheme can be mapped to an URL. URI was: ${uri}.`);\n        }\n        let rawLocation = uri.path.toString();\n        if (rawLocation.charAt(0) === '/') {\n            rawLocation = rawLocation.substr(1);\n        }\n        return new MiniBrowserEndpoint().getRestUrl().resolve(rawLocation).toString();\n    }\n\n}\n\nexport class MiniBrowserEndpoint extends Endpoint {\n    constructor() {\n        super({ path: 'mini-browser' });\n    }\n}\n"],"sourceRoot":""}